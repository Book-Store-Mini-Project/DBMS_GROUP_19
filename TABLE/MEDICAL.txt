CREATE TABLE medical (
    medical_id INT PRIMARY KEY AUTO_INCREMENT,
    reg_num VARCHAR(20),               
    source_name VARCHAR(100),
    source_type VARCHAR(50),
    contact_info VARCHAR(100),
    location VARCHAR(100),
    valid_from DATE,
    valid_to DATE,
    status ENUM('Pending','Approved','Rejected') DEFAULT 'Pending',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    
);

ALTER TABLE medical
ADD FOREIGN KEY (reg_num) REFERENCES enrollment(reg_num) ON DELETE CASCADE;

DELIMITER $$

CREATE TRIGGER after_medical_approved
AFTER UPDATE ON medical
FOR EACH ROW
BEGIN
    IF NEW.status = 'Approved' AND OLD.status != 'Approved' THEN
        UPDATE attendance_records ar
        JOIN attendance_session s
          ON ar.session_id = s.session_id
             AND s.session_date BETWEEN NEW.valid_from AND NEW.valid_to
        SET ar.status = 'Medical',
            ar.medical_id = NEW.medical_id
        WHERE ar.reg_num = NEW.reg_num
          AND ar.status = 'Absent';     END IF;
END $$

DELIMITER ;

UPDATE medical SET status = 'Approved' WHERE medical_id = 1;






