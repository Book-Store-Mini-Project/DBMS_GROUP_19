CREATE TABLE Course (
    course_id INT PRIMARY KEY AUTO_INCREMENT,
    course_code VARCHAR(20) NOT NULL UNIQUE,
    course_name VARCHAR(100) NOT NULL,
    department VARCHAR(15),
    level INT,
    semester INT,
    c_unit INT,
    credits INT,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);


DELIMITER $$

CREATE TRIGGER before_course_insert
BEFORE INSERT ON Course
FOR EACH ROW
BEGIN
    SET NEW.department = REGEXP_SUBSTR(NEW.course_code, '^[A-Z]+');

    SET NEW.level   = CAST(SUBSTRING(RIGHT(NEW.course_code, 4), 1, 1) AS UNSIGNED);
    SET NEW.semester = CAST(SUBSTRING(RIGHT(NEW.course_code, 4), 2, 1) AS UNSIGNED);
    SET NEW.c_unit    = CAST(SUBSTRING(RIGHT(NEW.course_code, 4), 3, 1) AS UNSIGNED);
    SET NEW.credits = CAST(SUBSTRING(RIGHT(NEW.course_code, 4), 4, 1) AS UNSIGNED);
END $$

DELIMITER ;




DROP TABLE course;
SELECT * FROM course;