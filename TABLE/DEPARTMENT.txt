CREATE TABLE department (
    dept_id INT PRIMARY KEY,
    dept_name VARCHAR(50),
    to_count INT DEFAULT 0,
    stu_count INT DEFAULT 0,
    lec_count INT DEFAULT 0,
    degree_offered VARCHAR(20),
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);


DELIMITER $$

CREATE TRIGGER after_user_insert
AFTER INSERT ON user
FOR EACH ROW
BEGIN
   
    IF NEW.user_type = 'student' THEN
        UPDATE department
        SET stu_count = stu_count + 1
        WHERE dept_id = NEW.dept_id;
    ELSEIF NEW.user_type = 'lecturer' THEN
        UPDATE department
        SET lec_count = lec_count + 1
        WHERE dept_id = NEW.dept_id;
    ELSEIF NEW.user_type = 't_officer' THEN
        UPDATE department
        SET to_count = to_count + 1
        WHERE dept_id = NEW.dept_id;
    END IF;
END$$

DELIMITER ;



DELIMITER $$

CREATE TRIGGER after_user_delete
AFTER DELETE ON user
FOR EACH ROW
BEGIN
     IF OLD.user_type = 'student' THEN
        UPDATE department
        SET stu_count = stu_count - 1
        WHERE dept_id = OLD.dept_id;
    ELSEIF OLD.user_type = 'lecturer' THEN
        UPDATE department
        SET lec_count = lec_count - 1
        WHERE dept_id = OLD.dept_id;
    ELSEIF OLD.user_type = 't_officer' THEN
        UPDATE department
        SET to_count = to_count - 1
        WHERE dept_id = OLD.dept_id;
    END IF;
END$$

DELIMITER ;






